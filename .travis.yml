sudo: required

language: generic

env:
  global:
  - image=awscli 

services:
  - docker

before_install:
    - curl https://omnitruck.chef.io/install.sh | sudo bash -s -- -P inspec 

script:
    -  docker build -t rahulinux/$image -f Dockerfile.$image .
    -  docker run --name $image -dt rahulinux/$image sh
    -  inspec exec test-$image.rb docker://$image
  

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]
    then
       echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
       docker push rahulinux/$image
    fi
